import java.sql.*;

public class SQLiteJDBC {
	
	private String _tableName;
	private String _databaseName;
	private String _nodeAddr;
	
	public SQLiteJDBC(String tableName) {
		this._tableName = tableName;
	}
	
	public SQLiteJDBC(String databaseName, String tableName) {
		this._tableName = tableName;
		this._databaseName = databaseName;
	}
	
	public SQLiteJDBC(String nodeAddr, String databaseName, String tableName) {
		this._tableName = tableName;
		this._databaseName = databaseName;
		this._nodeAddr = nodeAddr;
	}
	

	void createTable() {
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.sqlite.JDBC");
			c = DriverManager.getConnection("jdbc:sqlite:test.db");
			System.out.println("Opened database sucessfully!");
			
			stmt =  c.createStatement();
			String sql = "CREATE TABLE  " + this._tableName +
						" (ID INTEGER PRIMARY KEY, " +
					    "USER TEXT NOT NULL, " +
					    "PATH TEXT NOT NULL," +
						"FILENAME TEXT NOT NULL," +
					    "HASH TEXT NOT NULL)";
			
			stmt.executeUpdate(sql);
			stmt.close();
			c.close();
					    
		} catch(Exception e) {
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(1);
		}
		
		System.out.println("Table " + this._tableName + " created!");
		
	}
	
	
	
	void insertOnTable(String path, String fileName, String user, String hash) {
		Connection c = null;
		//Statement stmt = null;
		PreparedStatement pstmt = null;
		try {
			Class.forName("org.sqlite.JDBC");
			c = DriverManager.getConnection("jdbc:sqlite:test.db");
			//System.out.println("Opened database sucessfully!");
			
			c.setAutoCommit(false);
			String sql = "INSERT INTO "  + this._tableName + " (USER, PATH, FILENAME, HASH) " +
					"VALUES (?, ?, ?, ?)";
			pstmt = c.prepareStatement(sql);
			//pstmt.setInt(1, "NULL");
			pstmt.setString(1, user);
			pstmt.setString(2, path);
			pstmt.setString(3, fileName);
			pstmt.setString(4, hash);
			pstmt.executeUpdate();
			//pstmt.executeQuery();
			/*
			 * 
			 * stmt =  c.createStatement();
			String sql = "INSERT INTO SUBMISSIONS " +
						"(SUBID, USER, FILENAME, HASH) " + 
					    "VALUES (1, '100', '/usr/src/file.exe', 'hfkshdfkshdfkshdfk43r23')";		
			stmt.executeUpdate(sql);
			stmt.close();
			*/
			
			pstmt.close();
			c.commit();
			c.close();
					    
		} catch(Exception e) {
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(1);
		}
		
		//System.out.println("Data inserted!");
		
	}
	
	public void fetchTable() {
		Connection c = null;
		try {
            //String url = "jdbc:msql://200.210.220.1:1114/Demo";
			Class.forName("org.sqlite.JDBC");
			c = DriverManager.getConnection("jdbc:sqlite:/home/emanuel/research/executable-filter-network/test.db");
			System.out.println("Opened database sucessfully!");
            //Connection conn = DriverManager.getConnection(url,"","");
            Statement stmt = c.createStatement();
            ResultSet rs;
 
            rs = stmt.executeQuery("SELECT * from " + this._tableName);
            while ( rs.next() ) {
                String file = rs.getString("filename");
                String path = rs.getString("path");
                System.out.println(file);
                System.out.println(path);
            }
           stmt.close();
           c.close();
        } catch (Exception e) {
            System.err.println("Got an exception! ");
            System.err.println(e.getMessage());
        }
		
	}
	

	public static void main(String[] args) {
		SQLiteJDBC mysql = new SQLiteJDBC("submissions");
		//mysql.createTable();
		//mysql.insertOnTable(123, "vai.exe", "emanuel", "lsdf3423423lksls");
	}
		

}
